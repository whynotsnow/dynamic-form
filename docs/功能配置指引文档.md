## 内置组件配置

内置组件类型同样需要显式的调用`useInitHandlers` hook后使用
内置的组件类型仅用作演示并不一定能够覆盖全部的业务场景，更多的业务组件类型需要自定义后注册到`DynamicForm`组件中

### 支持的类型

```typescript
export type FieldComponentType =
  | 'Password'
  | 'ConfirmPassword'
  | 'TextInput'
  | 'NumberInput'
  | 'SelectField'
  | 'DatePicker'
  | 'Switch'
  | 'Rate'
  | 'TextDisplay'
  | string; // 允许任意字符串作为自定义组件类型

interface BaseFieldConfig {
  component: FieldComponentType; // 组件类型
}
```

### 配置演示

```typescript
[
  {
    id: 'username',
    label: '用户名',
    component: 'TextInput', //TextInput - 文本输入框
    required: true,
    componentProps: {
      placeholder: '请输入用户名',
      maxLength: 20,
      showCount: true
    },
    rules: [
      { required: true, message: '请输入用户名' },
      { min: 3, max: 20, message: '用户名长度3-20位' }
    ]
  },
  {
    id: 'password',
    label: '密码',
    component: 'Password', // Password - 密码输入框
    required: true,
    componentProps: {
      placeholder: '请输入密码',
      visibilityToggle: true
    },
    rules: [
      { required: true, message: '请输入密码' },
      {
        pattern: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/,
        message: '密码必须包含大小写字母和数字，长度至少8位'
      }
    ]
  },
  {
    id: 'confirmPassword',
    label: '确认密码',
    component: 'ConfirmPassword', //ConfirmPassword - 确认密码
    required: true,
    dependents: ['password'],
    rules: [
      { required: true, message: '请确认密码' },
      ({ getFieldValue }) => ({
        validator(_, value) {
          if (!value || getFieldValue('password') === value) {
            return Promise.resolve();
          }
          return Promise.reject(new Error('两次输入的密码不一致'));
        }
      })
    ]
  },
  {
    id: 'age',
    label: '年龄',
    component: 'NumberInput', //NumberInput - 数字输入框
    componentProps: {
      min: 0,
      max: 150,
      placeholder: '请输入年龄',
      formatter: (value) => `${value}岁`,
      parser: (value) => value.replace('岁', '')
    },
    rules: [
      { required: true, message: '请输入年龄' },
      { type: 'number', min: 0, max: 150, message: '年龄范围0-150' }
    ]
  },
  {
    id: 'city',
    label: '城市',
    component: 'SelectField', //SelectField - 下拉选择框
    required: true,
    componentProps: {
      placeholder: '请选择城市',
      options: [
        { label: '北京', value: 'beijing' },
        { label: '上海', value: 'shanghai' },
        { label: '广州', value: 'guangzhou' },
        { label: '深圳', value: 'shenzhen' }
      ],
      showSearch: true,
      filterOption: (input, option) => option?.label?.toLowerCase().includes(input.toLowerCase())
    }
  },
  {
    id: 'enabled',
    label: '是否启用',
    component: 'Switch', //Switch - 开关组件
    componentProps: {
      checkedChildren: '启用',
      unCheckedChildren: '禁用'
    }
  },
  {
    id: 'satisfaction',
    label: '满意度评分',
    component: 'Rate', // Rate - 评分组件
    componentProps: {
      count: 5,
      allowHalf: true,
      tooltips: ['很差', '差', '一般', '好', '很好']
    }
  },
  {
    id: 'birthday',
    label: '生日',
    component: 'DatePicker', //DatePicker - 日期选择器
    componentProps: {
      placeholder: '请选择生日',
      format: 'YYYY-MM-DD',
      disabledDate: (current) => current && current > dayjs().endOf('day')
    }
  },
  {
    id: 'summary',
    label: '汇总信息',
    component: 'TextDisplay', // TextDisplay - 文本显示
    dependents: ['field1', 'field2'],
    effect: ({ field1, field2 }) => ({
      value: `字段1: ${field1}, 字段2: ${field2}`,
      componentProps: {
        style: {
          color: field1 > field2 ? 'green' : 'red',
          fontWeight: 'bold'
        }
      }
    })
  }
];
```

## 自定义组件注册与配置

### 自定义组件注册

### 自定义组件定义

```tsx
const PriorityField: React.FC<FieldComponentProps> = ({ field, form }) => {
  // 在自定义组件内部处理 label 的动态展示
  const value = form.getFieldValue('priority');
  const renderLabel = () => {
    if (value === 'high') {
      return (
        <Space>
          <span>🔥 高优先级</span>
          <Tag color="red">重要</Tag>
        </Space>
      );
    }
    if (value === 'low') {
      return (
        <Space>
          <span>🧊 低优先级</span>
          <Tag color="blue">次要</Tag>
        </Space>
      );
    }
    return field?.formItemProps?.label || '优先级';
  };

  return (
    <Form.Item label={renderLabel()} name={field.id}>
      <Select options={field.componentProps?.options} />
    </Form.Item>
  );
};
// 4. 带单位的数字输入组件
const UnitNumberInput: FieldComponent = ({ field, value, onChange }) => {
  const unit = field.componentProps?.unit || '个';

  return (
    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
      <InputNumber
        value={value}
        onChange={onChange}
        disabled={field.componentProps?.disabled}
        min={field.componentProps?.min || 0}
        max={field.componentProps?.max || 999}
        style={{ flex: 1 }}
      />
      <span style={{ color: '#666' }}>{unit}</span>
    </div>
  );
};

//默认包裹在FormItem中
UnitNumberInput.wrapWithFormItem = true;
PriorityField.wrapWithFormItem = false;

const CustomComponentDemo: React.FC = () => {
  const componentRegistryConfig: ComponentRegistryConfig = {
    customComponents: {
      UnitNumberInput,
      NumberInput
    },
    allowOverride: false // 同名组件是否覆盖
  };

  useInitHandlers({
    handlers: [],
    options: { override: false },
    debug: true
  });

  return <DynamicForm formConfig={formConfig} form={form} onSubmit={handleSubmit} />;
};
```

## 自定义Handlers配置

允许自定义handles来处理不同的组件的需要的数据,配置对象的context中内置了操作内部Store的Api,操作store前你需要了解👉 [Store层级模型](./Store层级模型与设计架构.md)

```tsx
const conditionalDisplayHandler: CustomEffectResultHandler = {
  name: 'conditionalDisplay', // 当前handle id
  description: '根据条件控制字段显示', // 可选描述
  canHandle: (key) => key === 'conditionalDisplay', // 是否应用handle
  validate: (value) => typeof value === 'object' && 'condition' in value, // 可选 validate通过后执行 handle
  handle: (context, value) => {
    // context 提供操作 sotre的方法
    const { condition } = value;
    const shouldShow = typeof condition === 'function' ? condition() : condition;
    // 使用批量更新 API
    context.updateFieldMetaBatch({
      visible: shouldShow
    });
  }
};


const CustomComponentDemo: React.FC = () => {

  const componentRegistryConfig: ComponentRegistryConfig = {
    customComponents: {
      UnitNumberInput,
      NumberInput
    },
    allowOverride: false // 同名组件是否覆盖
  };

  useInitHandlers({
    enabled: true,
    handlers: [conditionalDisplayHandler]
    options: { override: false },
    debug: false
  });

  const formConfig = {
    fields: [
        {
        id: 'email',
        label: '邮箱',
        component: 'TextInput',
        span: 24,
        effect: (changedValue: any, allValues: any) => {
          // 使用条件显示处理器
          return {
            conditionalDisplay: {
              condition: !changedValue || changedValue.includes('@'), // 有效邮箱时显示
              message: '请输入有效的邮箱地址'
            }
          };
        }
      },
    ]
  }

  return <DynamicForm formConfig={formConfig} form={form} onSubmit={handleSubmit} />;
};



```
