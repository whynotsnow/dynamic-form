## å†…ç½®ç»„ä»¶é…ç½®

å†…ç½®ç»„ä»¶ç±»å‹åŒæ ·éœ€è¦æ˜¾å¼çš„è°ƒç”¨`useInitHandlers` hookåä½¿ç”¨
å†…ç½®çš„ç»„ä»¶ç±»å‹ä»…ç”¨ä½œæ¼”ç¤ºå¹¶ä¸ä¸€å®šèƒ½å¤Ÿè¦†ç›–å…¨éƒ¨çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ›´å¤šçš„ä¸šåŠ¡ç»„ä»¶ç±»å‹éœ€è¦è‡ªå®šä¹‰åæ³¨å†Œåˆ°`DynamicForm`ç»„ä»¶ä¸­

### æ”¯æŒçš„ç±»å‹

```typescript
export type FieldComponentType =
  | 'Password'
  | 'ConfirmPassword'
  | 'TextInput'
  | 'NumberInput'
  | 'SelectField'
  | 'DatePicker'
  | 'Switch'
  | 'Rate'
  | 'TextDisplay'
  | string; // å…è®¸ä»»æ„å­—ç¬¦ä¸²ä½œä¸ºè‡ªå®šä¹‰ç»„ä»¶ç±»å‹

interface BaseFieldConfig {
  component: FieldComponentType; // ç»„ä»¶ç±»å‹
}
```

### é…ç½®æ¼”ç¤º

```typescript
[
  {
    id: 'username',
    label: 'ç”¨æˆ·å',
    component: 'TextInput', //TextInput - æ–‡æœ¬è¾“å…¥æ¡†
    required: true,
    componentProps: {
      placeholder: 'è¯·è¾“å…¥ç”¨æˆ·å',
      maxLength: 20,
      showCount: true
    },
    rules: [
      { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å' },
      { min: 3, max: 20, message: 'ç”¨æˆ·åé•¿åº¦3-20ä½' }
    ]
  },
  {
    id: 'password',
    label: 'å¯†ç ',
    component: 'Password', // Password - å¯†ç è¾“å…¥æ¡†
    required: true,
    componentProps: {
      placeholder: 'è¯·è¾“å…¥å¯†ç ',
      visibilityToggle: true
    },
    rules: [
      { required: true, message: 'è¯·è¾“å…¥å¯†ç ' },
      {
        pattern: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/,
        message: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—ï¼Œé•¿åº¦è‡³å°‘8ä½'
      }
    ]
  },
  {
    id: 'confirmPassword',
    label: 'ç¡®è®¤å¯†ç ',
    component: 'ConfirmPassword', //ConfirmPassword - ç¡®è®¤å¯†ç 
    required: true,
    dependents: ['password'],
    rules: [
      { required: true, message: 'è¯·ç¡®è®¤å¯†ç ' },
      ({ getFieldValue }) => ({
        validator(_, value) {
          if (!value || getFieldValue('password') === value) {
            return Promise.resolve();
          }
          return Promise.reject(new Error('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´'));
        }
      })
    ]
  },
  {
    id: 'age',
    label: 'å¹´é¾„',
    component: 'NumberInput', //NumberInput - æ•°å­—è¾“å…¥æ¡†
    componentProps: {
      min: 0,
      max: 150,
      placeholder: 'è¯·è¾“å…¥å¹´é¾„',
      formatter: (value) => `${value}å²`,
      parser: (value) => value.replace('å²', '')
    },
    rules: [
      { required: true, message: 'è¯·è¾“å…¥å¹´é¾„' },
      { type: 'number', min: 0, max: 150, message: 'å¹´é¾„èŒƒå›´0-150' }
    ]
  },
  {
    id: 'city',
    label: 'åŸå¸‚',
    component: 'SelectField', //SelectField - ä¸‹æ‹‰é€‰æ‹©æ¡†
    required: true,
    componentProps: {
      placeholder: 'è¯·é€‰æ‹©åŸå¸‚',
      options: [
        { label: 'åŒ—äº¬', value: 'beijing' },
        { label: 'ä¸Šæµ·', value: 'shanghai' },
        { label: 'å¹¿å·', value: 'guangzhou' },
        { label: 'æ·±åœ³', value: 'shenzhen' }
      ],
      showSearch: true,
      filterOption: (input, option) => option?.label?.toLowerCase().includes(input.toLowerCase())
    }
  },
  {
    id: 'enabled',
    label: 'æ˜¯å¦å¯ç”¨',
    component: 'Switch', //Switch - å¼€å…³ç»„ä»¶
    componentProps: {
      checkedChildren: 'å¯ç”¨',
      unCheckedChildren: 'ç¦ç”¨'
    }
  },
  {
    id: 'satisfaction',
    label: 'æ»¡æ„åº¦è¯„åˆ†',
    component: 'Rate', // Rate - è¯„åˆ†ç»„ä»¶
    componentProps: {
      count: 5,
      allowHalf: true,
      tooltips: ['å¾ˆå·®', 'å·®', 'ä¸€èˆ¬', 'å¥½', 'å¾ˆå¥½']
    }
  },
  {
    id: 'birthday',
    label: 'ç”Ÿæ—¥',
    component: 'DatePicker', //DatePicker - æ—¥æœŸé€‰æ‹©å™¨
    componentProps: {
      placeholder: 'è¯·é€‰æ‹©ç”Ÿæ—¥',
      format: 'YYYY-MM-DD',
      disabledDate: (current) => current && current > dayjs().endOf('day')
    }
  },
  {
    id: 'summary',
    label: 'æ±‡æ€»ä¿¡æ¯',
    component: 'TextDisplay', // TextDisplay - æ–‡æœ¬æ˜¾ç¤º
    dependents: ['field1', 'field2'],
    effect: ({ field1, field2 }) => ({
      value: `å­—æ®µ1: ${field1}, å­—æ®µ2: ${field2}`,
      componentProps: {
        style: {
          color: field1 > field2 ? 'green' : 'red',
          fontWeight: 'bold'
        }
      }
    })
  }
];
```

## è‡ªå®šä¹‰ç»„ä»¶æ³¨å†Œä¸é…ç½®

### è‡ªå®šä¹‰ç»„ä»¶æ³¨å†Œ

### è‡ªå®šä¹‰ç»„ä»¶å®šä¹‰

```tsx
const PriorityField: React.FC<FieldComponentProps> = ({ field, form }) => {
  // åœ¨è‡ªå®šä¹‰ç»„ä»¶å†…éƒ¨å¤„ç† label çš„åŠ¨æ€å±•ç¤º
  const value = form.getFieldValue('priority');
  const renderLabel = () => {
    if (value === 'high') {
      return (
        <Space>
          <span>ğŸ”¥ é«˜ä¼˜å…ˆçº§</span>
          <Tag color="red">é‡è¦</Tag>
        </Space>
      );
    }
    if (value === 'low') {
      return (
        <Space>
          <span>ğŸ§Š ä½ä¼˜å…ˆçº§</span>
          <Tag color="blue">æ¬¡è¦</Tag>
        </Space>
      );
    }
    return field?.formItemProps?.label || 'ä¼˜å…ˆçº§';
  };

  return (
    <Form.Item label={renderLabel()} name={field.id}>
      <Select options={field.componentProps?.options} />
    </Form.Item>
  );
};
// 4. å¸¦å•ä½çš„æ•°å­—è¾“å…¥ç»„ä»¶
const UnitNumberInput: FieldComponent = ({ field, value, onChange }) => {
  const unit = field.componentProps?.unit || 'ä¸ª';

  return (
    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
      <InputNumber
        value={value}
        onChange={onChange}
        disabled={field.componentProps?.disabled}
        min={field.componentProps?.min || 0}
        max={field.componentProps?.max || 999}
        style={{ flex: 1 }}
      />
      <span style={{ color: '#666' }}>{unit}</span>
    </div>
  );
};

//é»˜è®¤åŒ…è£¹åœ¨FormItemä¸­
UnitNumberInput.wrapWithFormItem = true;
PriorityField.wrapWithFormItem = false;

const CustomComponentDemo: React.FC = () => {
  const componentRegistryConfig: ComponentRegistryConfig = {
    customComponents: {
      UnitNumberInput,
      NumberInput
    },
    allowOverride: false // åŒåç»„ä»¶æ˜¯å¦è¦†ç›–
  };

  useInitHandlers({
    handlers: [],
    options: { override: false },
    debug: true
  });

  return <DynamicForm formConfig={formConfig} form={form} onSubmit={handleSubmit} />;
};
```

## è‡ªå®šä¹‰Handlersé…ç½®

å…è®¸è‡ªå®šä¹‰handlesæ¥å¤„ç†ä¸åŒçš„ç»„ä»¶çš„éœ€è¦çš„æ•°æ®,é…ç½®å¯¹è±¡çš„contextä¸­å†…ç½®äº†æ“ä½œå†…éƒ¨Storeçš„Api,æ“ä½œstoreå‰ä½ éœ€è¦äº†è§£ğŸ‘‰ [Storeå±‚çº§æ¨¡å‹](./Storeå±‚çº§æ¨¡å‹ä¸è®¾è®¡æ¶æ„.md)

```tsx
const conditionalDisplayHandler: CustomEffectResultHandler = {
  name: 'conditionalDisplay', // å½“å‰handle id
  description: 'æ ¹æ®æ¡ä»¶æ§åˆ¶å­—æ®µæ˜¾ç¤º', // å¯é€‰æè¿°
  canHandle: (key) => key === 'conditionalDisplay', // æ˜¯å¦åº”ç”¨handle
  validate: (value) => typeof value === 'object' && 'condition' in value, // å¯é€‰ validateé€šè¿‡åæ‰§è¡Œ handle
  handle: (context, value) => {
    // context æä¾›æ“ä½œ sotreçš„æ–¹æ³•
    const { condition } = value;
    const shouldShow = typeof condition === 'function' ? condition() : condition;
    // ä½¿ç”¨æ‰¹é‡æ›´æ–° API
    context.updateFieldMetaBatch({
      visible: shouldShow
    });
  }
};


const CustomComponentDemo: React.FC = () => {

  const componentRegistryConfig: ComponentRegistryConfig = {
    customComponents: {
      UnitNumberInput,
      NumberInput
    },
    allowOverride: false // åŒåç»„ä»¶æ˜¯å¦è¦†ç›–
  };

  useInitHandlers({
    enabled: true,
    handlers: [conditionalDisplayHandler]
    options: { override: false },
    debug: false
  });

  const formConfig = {
    fields: [
        {
        id: 'email',
        label: 'é‚®ç®±',
        component: 'TextInput',
        span: 24,
        effect: (changedValue: any, allValues: any) => {
          // ä½¿ç”¨æ¡ä»¶æ˜¾ç¤ºå¤„ç†å™¨
          return {
            conditionalDisplay: {
              condition: !changedValue || changedValue.includes('@'), // æœ‰æ•ˆé‚®ç®±æ—¶æ˜¾ç¤º
              message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'
            }
          };
        }
      },
    ]
  }

  return <DynamicForm formConfig={formConfig} form={form} onSubmit={handleSubmit} />;
};



```
